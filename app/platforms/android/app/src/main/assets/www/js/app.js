(window.webpackJsonp=window.webpackJsonp||[]).push([["app"],{0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("db4d");var i=n("2b0e"),s={name:"App"},a=n("2877"),o=Object(a.a)(s,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)}),[],!1,null,"704275fe",null).exports,r=(n("82da"),n("ae17"),n("43f9")),l=n.n(r),c=(n("43f4"),n("313e")),u=n.n(c);const d=n("bc3a"),h="http://iot.chntek.com:3410";const g=new function(){this.timer=null,this.account="",this.token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoidGVzdCIsImV4cCI6MTYxMTUwMDM3NCwiaXNzIjoiSnd0S2V5TmFtZSIsImF1ZCI6Ikp3dEtleU5hbWUifQ.8nnKmig8Ar5uAC5WDZLxJZEl9mEpPsqbN4YrBt-H_UQ",this.warningsLength=0,this.devices={},this.ids=0,this.regions=async()=>{for(;;){const{data:t}=await d.get("http://dungbeetles.xyz:3410/devices/regions",{params:{account:this.account},headers:{Authorization:this.token}});if(t.val)return t.val}return null},this.getIds=async()=>{const{data:t}=await d.get("http://dungbeetles.xyz:3410/devices/ids",{params:{account:this.account},headers:{Authorization:this.token}});if(console.log("warningList: data.err "+t.err),t.err)throw t.err;return console.log(t.val),t.val},this.status=async(t,e,n)=>{let i="";for(let e of t)i+=e+",";console.log(`status: ${i} ${e} ${n}`);const{data:s}=await d.get(h+"/api/Terminal/HistoryData",{params:{date_begin:e,date_end:n,ids:i},headers:{Authorization:this.token}});if(console.log("status: data.err "+s.err),s.err)throw s.err;let a={};for(let t in s.val){let e=s.val[t];a[t]=[];for(let n of e)a[t].push({hydraulic_pressure:n.pressure,temperature:n.temper,energy:n.electricity,signal_intensity:n.rssi,status_of_low_hydraulic_pressure:0,status_of_high_hydraulic_pressure:0,status_of_leak:0,status_of_low_temperature:0,status_of_high_temperature:0,status_of_slope:0,status_of_vibration:0,status_of_energy:0,status_of_pressure_sensor:0,status_of_water_quality:0,status_of_subzero_temperature:0,status_of_low_signal_intensity:0,type:n.terminalType,longitude:n.longitude,latitude:n.latitude,location:n.customerunit,time:n.monitorsTime})}return a},this.warningList=async t=>{console.log("warningList: "+t);const{data:e}=await d.get(h+"/api/Terminal/RealTimeData",{params:{searchDate:t},headers:{Authorization:this.token}});if(console.log("warningList: data.err "+e.err),e.Err)throw e.Err;if(e.err)throw e.err;let n={};for(let t of e.val){let e=t.terminalNum,i={id:e,location:t.prefecturecity+t.distriancounty+t.customerunit,warning_type:t.warnName,time:t.monitorsTime,longitude:t.longitude,latitude:t.latitude};n[e]||(n[e]={id:t.terminalNum,location:i.location,time:i.time,children:[]}),n[e].children.push(i)}let i=[];for(let t in n)i.push(n[t]);return i},this.transCityList=async()=>{let t=await this.regions(),e=[];for(let n in t){let i=n,s=[],a=t[n];for(let t in a){let e=[];for(let n of a[t])this.devices[n]&&e.push(this.devices[n].location+n);s.push({areaName:t,deviceList:e})}e.push({cityName:i,children:s})}return console.log("transCityList: citys ",JSON.stringify(e)),e},this.transDeviceStatus=async t=>{console.log("transDeviceStatus: ");let e=(new Date).toISOString().slice(0,10),n=[];for(let e of t)n.push(this.devices[e].id);let i=await this.status(n,e,e),s=[],a=[],o=[];for(let t in i){let e=i[t];s.push(t);let n={name:t,type:"line",data:[]};for(let n of e)n.id=t,o.push(n);let r=new Date;for(let t=0,i=0;t<24&&t<r.getHours();t++){for(let n of e){if(t==new Date(n.time).getHours()){i=n.hydraulic_pressure;break}}n.data.push(i)}a.push(n)}let r={chart:[{title:{text:"压力"},legend:{data:s},xAxis:{data:["00","01","02","03","04","05","06","07","08","09","10","11","12","14","15","16","17","18","19","20","21","22","23"]},series:a}],list:o};return console.log("transDeviceStatus: val ",r),r},this.transUnitList=async()=>{let t=[];for(let e in this.devices)null!=this.devices[e].latitude&&null!=this.devices[e].longitude&&t.push(this.devices[e]);return console.log(t),t},this.transWarningListOfToday=async()=>{console.log("transWarningListOfToday: ");let t=(new Date).toISOString().slice(0,10),e=await this.warningList(t);return console.log("transWarningListOfToday: ",e),e},this.transWarningListOfMonths=async t=>{let e=await this.warningList(t);return console.log("transWarningListOfMonths: return"),e},this.transDeviceStatusHistory=async(t,e,n)=>{console.log("transDeviceStatusHistory: ");let i=[];for(let e of t)i.push(this.devices[e].id);let s=await this.status(i,e,n),a=[];for(let t in s){let e=s[t];for(let n of e)n.id=t,a.push(n)}return console.log("transDeviceStatusHistory: val "),a},this.notify=t=>{},this.syncingWarnings=async()=>{console.log("notification: warningsLength "+this.warningsLength);try{let t=await g.transWarningListOfToday();t.length!=this.warningsLength&&window.cordova.plugins.notification.local.schedule({text:"有新的告警信息...",foreground:!0}),this.warningsLength=t.length;let e=this.ids.slice(0),n=e.length,i=0,s=0;for(let n in t){-1==e.indexOf(t[n].id)&&delete t[n]}for(let n of t){if(null==n)continue;let t=e.indexOf(n.id);-1!=t&&(e.splice(t,1),s++)}i=n-s,console.log(`notification:${n} ${i} ${s} ${t.length}`),this.notify({warnings:t,sum:n,normal:i,abnormal:s})}catch(t){console.error(t)}},this.login=async(t,e)=>{const{data:n}=await d.get(h+"/api/user/login",{params:{account:t,password:e}});if(n.err)throw n.err;console.log("token:",n.val.token),this.token=n.val.token,this.account=t,this.ids=await this.getIds();let i=this.ids.slice(0);for(let t=Date.now(),e=0;i.length&&e<10;e++,t-=6048e5){let e=new Date(t).toISOString().slice(0,10),n=await this.status(i,e,e);for(let t in n){let e=n[t];for(let n of e){n.id=t,this.devices[t]=n,this.devices[n.location+t]=n;break}let s=i.indexOf(t);i.splice(s,1)}}try{document.addEventListener("deviceready",async()=>{await this.syncingWarnings(),this.timer=setInterval(async()=>this.syncingWarnings(),2e4),window.cordova.plugins.backgroundMode.enable()})}catch(t){}},this.logout=async()=>{clearInterval(timer),window.cordova.plugins.backgroundMode.disable()}};var f=g,p=n("bc3a"),m=n.n(p);function y(t){if(!t||"[object Object]"!=Object.prototype.toString.call(t))return"";let e="?";return Object.keys(t).forEach(n=>{"[object Object]"===Object.prototype.toString.call(t[n])||"[object Array]"===Object.prototype.toString.call(t[n])?e+=n+"="+JSON.stringify(t[n])+"&":e+=n+"="+t[n]+"&"}),e.substr(0,e.length-1)}var w={getCityList:t=>m.a.get("/cityList.json"+y(t)),getUnitList:t=>m.a.get("/unitList.json"+y(t)),getDeviceStatus:t=>m.a.get("/deviceStatus.json"+y(t)),getStatistics:t=>m.a.get("/statisticsInfo.json"+y(t)),getWarningListOfToday:t=>m.a.get("/todayList.json"+y(t)),getWarningListOfHistory:t=>m.a.get("/historyList.json"+y(t)),getWarningStatistics:t=>m.a.get("/warnStatistics.json"+y(t))},v=n("8c4f");i.default.use(v.a);const b=[{path:"*",redirect:{name:"login"}},{name:"login",path:"/login",component:()=>n.e("chunk-32dcaffd").then(n.bind(null,"dd7b"))},{name:"index",path:"/index",component:()=>n.e("chunk-ca91d7ca").then(n.bind(null,"1e4b")),children:[{name:"home",path:"/home",component:()=>n.e("chunk-17d5d026").then(n.bind(null,"6511"))},{name:"gmap",path:"/gmap",component:()=>n.e("chunk-3024afd4").then(n.bind(null,"9041"))},{name:"realtime",path:"/realtime",component:()=>n.e("chunk-1f5350de").then(n.bind(null,"d78d"))},{name:"history",path:"/history",component:()=>n.e("chunk-e09b4078").then(n.bind(null,"43c4"))},{name:"stat",path:"/stat",component:()=>n.e("chunk-c2d16398").then(n.bind(null,"99d8"))},{name:"detail",path:"/detail",component:()=>n.e("chunk-3fdb8807").then(n.bind(null,"1000"))}]}];const _=new v.a({mode:"history",base:function(){let t=location.pathname;return t.substring(0,t.lastIndexOf("/")+1)}(),routes:b});_.afterEach(()=>{window.scrollTo(0,0)});var L=_,k=n("2f62"),S={setNotify(t,e){t.Notify=e}};i.default.use(k.a);var O=new k.a.Store({state:{Notify:{}},mutations:S,actions:{},modules:{}}),I=n("bd0c"),D=n.n(I);i.default.use(l.a),i.default.prototype.$echarts=u.a,i.default.prototype.$chntek=f,i.default.prototype.$http=w,i.default.use(D.a,{ak:"aczIoSxQtHDKl7gLRKWxySCwKOvzXq3u"}),i.default.config.productionTip=!1,new i.default({router:L,store:O,render:t=>t(o)}).$mount("#app")},"82da":function(t,e,n){},ae17:function(t,e,n){}},[[0,"runtime","npm.echarts","npm.babel-polyfill","npm.zrender","npm.vue-material","npm.vue-baidu-map","npm.vue","vendors~app"]]]);